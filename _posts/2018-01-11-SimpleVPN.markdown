---
layout:     post
title:      "SimpleVPN"
date:       2018-03-11 23:40:45
author:     "faxiang1230"
header-img: "img/post-bg-2015.jpg"
catalog: true
tags:
  - network
---
# 简单VPN示例
## 需求背景
A需要所有数据在网络上传输时都必须是经过加密的，以防止其他人窃取隐私，所以需要一种方案能够加密所有的网络数据。其实现有的方案已经有好多了,像openvpn,IPSec,sock5等理论上都是能够达到目的的。下面就是根据openvpn的原理写的简要demo,加解密和密钥相关的可以自己增加。
## 方向
特别感谢大牛[Bomb250](http://blog.csdn.net/dog250/article/details/6964047),虽未谋面但深表佩服。

- 1.怎么能够拦截住用户的所有数据呢  
这个是分场景的，不同的场景需要细微的修改。不过我下面的所有核心都是利用IP层的路由功能和tun网络设备，这里先回顾一下搜索路由表的策略和tun设备的原理:
```
1.搜索匹配的主机地址
2.搜索匹配的网络地址
3.搜索默认路由表
```
tun设备的位置:  
![image](../img/tun-position.png)  
第一个问题是在不修改内核和应用的情况下如何能够拦截用户所有的
使用tun设备来拦截所有未加密的数据，加密封装然后再发出去。同样
网络环境主要有两种:服务端和本地的IP不处于同一
